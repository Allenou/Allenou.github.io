---
title: Javascript åœ¨æµè§ˆå™¨ä¸­æ˜¯å¦‚ä½•å·¥ä½œçš„
---
# Javascript åœ¨æµè§ˆå™¨ä¸­æ˜¯å¦‚ä½•å·¥ä½œçš„
- æ™®é€šä»»åŠ¡ã€å®ä»»åŠ¡ã€å¾®ä»»åŠ¡çš„æ‰§è¡Œé¡ºåº
- ä¸ºä»€ä¹ˆ Promise æ‰§è¡Œä¼˜å…ˆçº§é«˜äº SetTimeOutï¼Ÿï¼ˆ2019-04-20ï¼‰
<!-- 
ä½ æˆ–è®¸å·²ç»é›¶æ•£åœ°äº†è§£äº† Javascript çš„è°ƒç”¨æ ˆï¼ˆCall stackï¼‰ã€äº‹ä»¶å¾ªç¯ï¼ˆEvent loopï¼‰ã€å›è°ƒé˜Ÿåˆ—ï¼ˆCallback queueï¼‰çš„æ¦‚å¿µï¼Œä½†æ˜¯è¿˜æ˜¯ä¸çŸ¥é“ Javascript åˆ°åº•æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œè¿™å¯èƒ½æ˜¯å› ä¸ºä½ çš„çŸ¥è¯†è¿˜æ²¡æˆä½“ç³»ã€‚çŸ¥è¯†è¦æˆä½“ç³»ä¸ä½†è¦ä»å¾®è§‚ä¸Šå»æ”»ç ´è¿˜è¦ä»å®è§‚ä¸Šå»å…³è”ï¼Œè¿™æ ·å¾—åˆ°çš„çŸ¥è¯†æ‰èƒ½è®°å¾—ç‰¢å›ºè€Œä¸æ˜¯è¿‡çœ¼ä¾¿å¿˜ã€‚ä¸‹é¢å¼€å§‹æˆ‘çš„è®²è¿°ã€‚ -->

Javascript å·¥ä½œè¿‡ç¨‹å¯åˆ†ä¸ºè§£æå’Œæ‰§è¡Œä¸¤ä¸ªé˜¶æ®µã€‚
# æ¦‚å¿µ
## EC

### Globl EC
### Function EC
å‡½æ•°æ¯æ¬¡è¢«è°ƒç”¨æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºå‡½æ•°æ‰§è¡Œç¯å¢ƒã€‚
## CESï¼ˆæ‰§è¡Œç¯å¢ƒæ ˆï¼‰
å‡½æ•°æ‰§è¡Œç¯å¢ƒä¼šè¿›å…¥æ‰§è¡Œç¯å¢ƒæ ˆã€‚
CES ä¹Ÿå« Call Stackï¼ˆè°ƒç”¨æ ˆï¼‰ï¼Œ
Javascript æ˜¯å•çº¿ç¨‹è¯­è¨€ï¼Œå®ƒåªæœ‰ä¸€ä¸ªè°ƒç”¨æ ˆï¼Œæ‰€ä»¥å®ƒæ¯æ¬¡åªèƒ½æ‰§è¡Œä¸€æ®µä»£ç ã€‚è‡³äºä¸ºä»€ä¹ˆå®ƒè¢«è®¾è®¡æˆå•çº¿ç¨‹è¯­è¨€ï¼Œæ˜¯å› ä¸ºå®ƒçš„ç”¨é€”å†³å®šäº†å®ƒçš„è®¾è®¡ã€‚Javascript æœ€æ—©çš„ç›®çš„æ˜¯è¢«ç”¨æ¥ä¸°å¯Œç½‘é¡µäº¤äº’ï¼Œè¿™å¿…ç„¶é¿å…ä¸äº†è¦æ“ä½œ DOM ï¼Œå¦‚æœ Javascript æ˜¯è¢«è®¾è®¡æˆå¤šçº¿ç¨‹ï¼Œå°±ä¼šå‡ºç°ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹åŒä¸€ä¸ª DOM æ—¶ ï¼Œæµè§ˆå™¨ä¸çŸ¥ä»¥ä¸¤ä¸ªçº¿ç¨‹ä¸ºå‡†çš„éš¾é¢˜ï¼Œæ‰€ä»¥ Javacript åœ¨æµè§ˆå™¨ä¸­åªèƒ½æ˜¯å•çº¿ç¨‹ã€‚
## ä½œç”¨åŸŸ






## è§£æé˜¶æ®µ
## è¯æ³•åˆ†æ

## è¯­æ³•åˆ†æ

## ä½œç”¨åŸŸç¡®å®š



## æ‰§è¡Œé˜¶æ®µ
Javascript ä»£ç è‡ªä¸Šå‘ä¸‹è§£æï¼Œè§£æè¿‡ç¨‹ä¸­é¦–å…ˆä¼šåˆ›å»º Global Objctï¼ˆå…¨å±€å¯¹è±¡ï¼‰ï¼Œè§£æåˆ°å‡½æ•°æ˜¯ä¼šåˆ›å»º VO(å˜é‡å¯¹è±¡)ï¼Œåœ¨åˆ›å»º VO è¿‡ç¨‹ä¸­ä¼šå»ºç«‹ EC ä½œç”¨åŸŸï¼ˆæ‰€ä»¥æ—¶å€™å‡½æ•°çš„ä½œç”¨åŸŸæ˜¯åœ¨å‡½æ•°å®šä¹‰çš„æ—¶å€™å°±å·²ç»å†³å®šäº†ï¼Œè¿™å«è¯æ³•ä½œç”¨åŸŸï¼‰ã€‚
## åˆ›å»º Global EC
### åˆ›å»º VO å¯¹è±¡
#### åˆ›å»ºä½œç”¨åŸŸé“¾
#### this æŒ‡å‘
#### å‹å…¥ CES

## åˆ›å»º Function EC
## åˆ›å»º AO å¯¹è±¡
#### åˆ›å»ºä½œç”¨åŸŸé“¾
#### this æŒ‡å‘
#### å‹å…¥ CES


## æ‰§è¡Œå‡½æ•°ä»£ç 


## åƒåœ¾å›æ”¶




























## Call Stack (è°ƒç”¨æ ˆ)  
è°ƒç”¨æ ˆæ˜¯ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œå®ƒæè¿°äº†æ˜¯ä»£ç æ‰§è¡Œçš„ä¸€ä¸ªè¡Œä¸ºç©ºé—´ã€‚
```javascript
function baz(){
    console.log('Hello from baz')
}

function bar(){
    baz()
}

function foo(){
   bar()
}

foo()
```
ä¸Šé¢çš„ä»£ç ä¼šå…ˆæŒ‰è°ƒç”¨é¡ºåºå‹å…¥è°ƒç”¨æ ˆï¼ˆCall stackï¼‰ï¼Œç„¶åå†æŒ‰è°ƒç”¨æ ˆä¸­çš„é¡ºåºä»ä¸Šå¾€ä¸‹æ‰§è¡Œï¼Œæ‰§è¡Œå®Œçš„ä»£ç åä¼šç«‹å³å¼¹å‡ºè°ƒç”¨æ ˆï¼Œç„¶åå†ç»§ç»­æ‰§è¡Œä¸‹ä¸€æ®µä»£ç ã€‚è¿™å°±æ˜¯è°ƒç”¨æ ˆçš„åè¿›å…ˆå‡ºï¼ˆLIFOï¼šLast in first outï¼‰ç‰¹ç‚¹ï¼š

![](/better/browser/1_rRoLpv-Zrmpa-srNhwlbvA.gif)

åè¿›å…ˆå‡ºæœ‰ç‚¹ç±»ä¼¼äºæªæ¢°(ğŸ”«)çš„å°„å‡»ï¼Œåè£…çš„å­å¼¹åè€Œä¼šå…ˆè¢«å‘å°„ã€‚
## Event Loopï¼ˆäº‹ä»¶å¾ªç¯ï¼‰
ä¸Šé¢æ˜¯åŒæ­¥ä»»åŠ¡çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œæˆ‘ä»¬å†çœ‹ä¸‹å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œè¿‡ç¨‹ã€‚

```javascript
function printHello() {
    console.log('Hello from baz');
}

function baz() {
    setTimeout(printHello, 3000);
}

function bar() {
    baz();
}

function foo() {
    bar();
}

foo();
```
::: tip
setTimeout ä¸å±äº Javascript APIï¼Œå®ƒå±äºæµè§ˆå™¨ APIã€‚
:::
æ‰€æœ‰çš„ä»»åŠ¡éƒ½ä¼šå…ˆè¿›å…¥è°ƒç”¨æ ˆï¼Œå¦‚æœ Javscript å¼•æ“æ£€æµ‹åˆ°è¯¥ä»»åŠ¡æ˜¯åŒæ­¥ä»»åŠ¡åˆ™ä¼šåœ¨è°ƒç”¨æ ˆä¿ç•™ï¼Œå¼‚æ­¥ä»»åŠ¡åˆ™ä¼šåœ¨å›è°ƒé˜Ÿåˆ—å…ˆæŒ‚èµ·ï¼Œç­‰è°ƒç”¨æ ˆä¸­çš„åŒæ­¥ä»»åŠ¡å…¨éƒ¨æ‰§è¡Œå®Œä¸”å…¨éƒ¨å‡ºæ ˆåï¼Œå¼‚æ­¥ä»»åŠ¡æ‰ä¼šè¿›å…¥è°ƒç”¨æ ˆï¼Œè¿™ç§é’ˆå¯¹åŒä¸€ä¸ªä»»åŠ¡çš„è°ƒç”¨æ–¹å¼ï¼ˆè¿›æ ˆ->å‡ºæ ˆ->è¿›æ ˆï¼‰å°±å«äº‹ä»¶å¾ªç¯ã€‚äº‹ä»¶å¾ªç¯æ˜¯é’ˆå¯¹äºå¼‚æ­¥ä»»åŠ¡çš„ï¼Œæ¯å½“è°ƒç”¨æ ˆæ— ä»»åŠ¡æ—¶ï¼Œäº‹ä»¶å¾ªç¯å°±ä¼šä»å›è°ƒé˜Ÿåˆ—å–å‡ºä¸€ä¸ªä»»åŠ¡å‹å…¥è°ƒç”¨æ ˆæ‰§è¡Œã€‚

![](/better/browser/1_9mv-g9E-87Sji9j7YR08Fw.gif)



å¦‚æœè°ƒç”¨æ ˆæ°¸è¿œæœ‰ä»»åŠ¡ï¼Œå›è°ƒé˜Ÿåˆ—ä¸­çš„å¼‚æ­¥ä»»åŠ¡å°±æ°¸è¿œä¸ä¼šæ‰§è¡Œã€‚æœ‰é™çš„ä»»åŠ¡æ€»ä¼šæ‰§è¡Œå®Œçš„ï¼Œå¦‚æœæ‰§è¡Œä¸å®Œå°±è¯´æ˜ä¸€ç›´æœ‰ä»»åŠ¡è¿›å…¥è°ƒç”¨æ ˆï¼š
![](/better/browser/3925f8363d7a763e6474709ccddf7d96.png)
è°ƒç”¨æ ˆæ˜¯æœ‰ä»»åŠ¡ä¸ªæ•°é™åˆ¶çš„ï¼Œå¦‚æœè¶…å‡ºé™åˆ¶æµè§ˆå™¨å°±ä¼šæŠ¥æ ˆæº¢å‡ºé”™è¯¯ï¼š

![](/better/browser/1_VODaYMxARLv6E1fguKYVKA.png)

å¼‚æ­¥ä»»åŠ¡æœ‰åˆ†å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡ï¼Œå¾®ä»»åŠ¡çš„æ‰§è¡Œä¼˜å…ˆçº§è¦é«˜äºå®ä»»åŠ¡ã€‚
```javascript
 console.log('script start');
 2 
 3 setTimeout(function() {
 4   console.log('setTimeout');
 5 }, 0);
 6 
 7 Promise.resolve().then(function() {
 8   console.log('promise1');
 9 }).then(function() {
10   console.log('promise2');
11 });
12 
13 console.log('script end');

script start
script end
promise1
promise2
setTimeout
```

## å›è°ƒé˜Ÿåˆ—
ä¸Šé¢äº‹ä»¶å¾ªç¯ä¸­å·²ç»è®²è§£ï¼Œå›è°ƒé˜Ÿåˆ—æ˜¯å¼‚æ­¥ä»»åŠ¡çš„æš‚å­˜åŒºåŸŸã€‚å›è°ƒé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡è¦ç­‰åˆ°è°ƒç”¨æ ˆæ¸…ç©ºæ—¶åœ¨è¿›å…¥è°ƒç”¨æ ˆï¼Œæ‰€ä»¥ setTimeout() è®¾ç½®çš„å»¶è¿Ÿæ‰§è¡Œå¹¶ä¸æ˜¯å¯é çš„ã€‚


æµè§ˆå™¨å’Œ NodeJs ä¸­çš„ Event loopå¹¶ä¸ä¸€è‡´ï¼Œå› ä¸ºå¯¹ NodeJs ä¸æ˜¯å¾ˆäº†è§£å°±ä¸è®²è¿°äº†ã€‚ 
å‚è€ƒæ–‡ç« ï¼š
> https://itnext.io/how-javascript-works-in-browser-and-node-ab7d0d09ac2f
http://www.ruanyifeng.com/blog/2014/10/event-loop.html
https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/


https://feclub.cn/post/content/ec_ecs_hosting
https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Functions#%E9%97%AD%E5%8C%85%28Closures%29


https://blog.fundebug.com/2019/03/20/understand-javascript-context-and-stack/